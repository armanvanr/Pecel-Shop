<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&amp;display=swap" rel="stylesheet">

    <title>Pecel Shop</title>

    <style>
        * {
            font-family: 'Gowun Dodum', sans-serif;
        }

        .mypic {
            width: 100%;
            height: 350px;

            background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
            url('https://www.masakapahariini.com/wp-content/uploads/2021/10/Nasi-Pecel-Madiun-780x440.jpg');
            background-position: center 60%;
            background-size: cover;

            color: white;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .mypic>h1 {
            font-size: 30px;
        }

        .mybox {
            width: 95%;
            max-width: 700px;
            padding: 20px;
            box-shadow: 0px 0px 10px 0px lightblue;
            margin: 20px auto;
        }

        .mypecel {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }

        .mypecel>input {
            width: 70%;
        }

        .mybox>li {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;

            margin-bottom: 10px;
            min-height: 48px;
        }

        .mybox>li>h2 {
            max-width: 75%;
            font-size: 20px;
            font-weight: 500;
            margin-right: auto;
            margin-bottom: 0px;
        }

        .mybox>li>h2.done {
            text-decoration: line-through
        }
    </style>
</head>

<body style="background-color:#00031b">
    <div class="mypic">
        <h1>Pecel Shop</h1>
        <p>I write here downside for my pecel-list in my future. Hope this is will come true :)</p>
    </div>
    <div class="mybox" style="background-color:white">
        <div class="row">
            <div class="mypecel col-9">
                <select class="form-select" id="pecel">
                    <option selected disabled>Select your food item</option>
                    <option id="Nasi Pecel" value="Nasi Pecel">Nasi Pecel</option>
                    <option id="Fried Chicken" value="Fried Chicken">Fried Chicken</option>
                    <option id="Fried Tempeh" value="Fried Tempeh">Fried Tempeh</option>
                    <option id="Fried Tofu" value="Fried Tofu">Fried Tofu</option>
                    <option id="Fried Egg" value="Fried Egg">Fried Egg</option>
                    <option id="Ice Tea" value="Ice Tea">Ice Tea</option>
                    <option id="Orange Juice" value="Orange Juice">Orange Juice</option>
                    <option id="Coconut Water" value="Coconut Water">Coconut Water</option>
                </select>
            </div>
            <div class="col-3">
                <button onclick="save_pecel()" type="button" class="btn btn-outline-primary float-end">
                    Add menu
                </button>
            </div>
        </div>
    </div>
    <div class="mybox" style="background-color:white; min-height: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th width="5%">#</th>
                    <th width="30%">Name of menu</th>
                    <th width="25%">Price</th>
                    <th class="text-center" width="25%">Quantity</th>
                    <th class="text-center" width="15%"></th>
                </tr>
            </thead>
        </table>
        <div id="pecel-list"></div>
    </div>
    <div class="d-flex justify-content-center mb-5">
        <button onclick="create_order()" type="button" class="btn btn-success">Make Order!</button>
    </div>
    
</body>

<!-- Sweet Alert -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    var price  = [];
    price['Nasi Pecel'] = 20000;
    price['Fried Chicken'] = 10000;
    price['Fried Tempeh'] = 2000;
    price['Fried Tofu'] = 2000;
    price['Fried Egg'] = 5000;
    price['Ice Tea'] = 4000;
    price['Orange Juice'] = 4000;
    price['Coconut Water'] = 7000;

    // Format Rupiah
    function formatRupiah(angka, prefix){
        var number_string = angka.replace(/[^,\d]/g, '').toString(),
        split   		= number_string.split(','),
        sisa     		= split[0].length % 3,
        rupiah     		= split[0].substr(0, sisa),
        ribuan     		= split[0].substr(sisa).match(/\d{3}/gi);

        // tambahkan titik jika yang di input sudah menjadi angka ribuan
        if(ribuan){
            separator = sisa ? '.' : '';
            rupiah += separator + ribuan.join('.');
        }

        rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
        return prefix == undefined ? rupiah : (rupiah ? 'Rp ' + rupiah + ',-' : '');
    }

    $(document).ready(function () {
        show_pecel();
    });
    
    function show_pecel() {
        $.ajax({
            type: "GET",
            url: "/pecel",
            data: {},
            success: function (response) {
                $('#pecel-list').empty();
                let rows = response['pecels'];
                for (let i = 0; i < rows.length; i++) {
                    let pecel = rows[i]['pecel'];
                    let num = rows[i]['num'];
                    let done = rows[i]['done'];
                    let temp_html = 
                        `<table class="table">
                            <tbody>
                                <tr>
                                    <td width="5%"><li></li></td>
                                    <td width="30%">${pecel}</td>
                                    <td id="price_${pecel}" width="25%">${formatRupiah(price[pecel].toString(), '')}</td>
                                    <td class="text-center" width="25%">
                                        <button onClick="decreaseCount(event, this, '${pecel}')" type="button" class="btn btn-outline-danger mx-2">-</button>
                                        <input id="total" type="text" value="1" class="col-2 text-center">
                                        <button onClick="increaseCount(event, this, '${pecel}')" type="button" class="btn btn-outline-primary mx-2">+</button>
                                        
                                        <input id="totalprice_${pecel}" type="hidden" value="${price[pecel]}" class="col-2 text-center">
                                    </td>
                                    <td class="text-center" width="15%">
                                        <button onclick="delete_pecel(${num})" type="button" class="btn btn-danger">Cancel</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>`;
                        
                        // Disable Input that already on Pecel-List with ID
                        $(`[id='${pecel}']`).hide();
                    $('#pecel-list').append(temp_html);
                }
            }
        });
    }
    
    function save_pecel() {
        let pecel = $('#pecel').val();
        $.ajax({
            type: "POST",
            url: "/pecel",
            data: {pecel_give: pecel},
            success: function (response) {
                $('#pecel').val(null);
                show_pecel();
            }
        });
    }
    
    function delete_pecel(num) {
        $.ajax({
            type: "POST",
            url: "/delete",
            data: { num_give: num },
            success: function (response) {
                show_pecel();
            }
        });
    }
    
    function create_order() {
        let total = 0;
        $.ajax({
            type: "GET",
            url: "/pecel",
            data: {},
            success: function (response) {
                let rows = response['pecels'];
                for (let i = 0; i < rows.length; i++) {
                    let pecel = rows[i]['pecel'];
                    let num = rows[i]['num'];
                    total += parseInt($(`[id='totalprice_${pecel}']`).val());
                    delete_pecel(num);
                }
                swal({
                    title: "Total Price!",
                    text: `${formatRupiah(total.toString(), '')}`,
                    icon: "success",
                    button: false
                });
            }
        });
        
            
    }

    function increaseCount(a, b, id_menu) {
        var input = b.previousElementSibling;
        var value = parseInt(input.value, 10);
        value = isNaN(value) ? 0 : value;
        value++;
        input.value = value;
        countPrice(value, id_menu);
    }

    function decreaseCount(a, b, id_menu) {
        var input = b.nextElementSibling;
        var value = parseInt(input.value, 10);
        if (value > 1) {
            value = isNaN(value) ? 0 : value;
            value--;
            input.value = value;
        }
        countPrice(value, id_menu);
    }

    function countPrice(value, id_menu){
        // Initialize price from array IS value id-menu
        var count_price  = price[id_menu];
        // Count of the price
        var total = parseInt(count_price) * parseInt(value);
        // To show the price
        $(`[id='price_${id_menu}']`).html(formatRupiah(total.toString(), ''));

        // To show the Total price
        $(`[id='totalprice_${id_menu}']`).html(total);
    }
    $('#pecel')
</script>

</html>